---
import { readFileSync } from 'fs';
import { resolve } from 'path';

const codeFiles = [
  {
    name: 'Go',
    lang: 'go',
    file: 'example.go',
    icon: 'ðŸ”·'
  },
  {
    name: 'Rust',
    lang: 'rust',
    file: 'example.rs',
    icon: 'ðŸ¦€'
  },
  {
    name: 'TypeScript',
    lang: 'typescript',
    file: 'example.ts',
    icon: 'ðŸ’™'
  },
  {
    name: 'Swift',
    lang: 'swift',
    file: 'example.swift',
    icon: 'ðŸŽ'
  },
  {
    name: 'Shell',
    lang: 'bash',
    file: 'example.sh',
    icon: 'ðŸ’»'
  }
];

// Read code samples
const samples = codeFiles.map(({ name, lang, file, icon }) => {
  try {
    const filePath = resolve('./src/code-samples', file);
    const code = readFileSync(filePath, 'utf-8');
    return { name, lang, code, icon };
  } catch (error) {
    return { name, lang, code: `// Error loading ${file}`, icon };
  }
});
---

<section id="examples" class="container mx-auto px-4 py-20">
  <div class="text-center mb-12">
    <h2 class="text-4xl font-bold text-sn-fg mb-4">Syntax Highlighting</h2>
    <p class="text-sn-fg-muted text-lg max-w-2xl mx-auto">
      See how Subliminal Nightfall looks across different programming languages with carefully calibrated syntax colors.
    </p>
  </div>

  <div class="max-w-6xl mx-auto">
    <!-- Tab buttons -->
    <div class="flex flex-wrap gap-2 mb-4 border-b border-sn-border">
      {samples.map((sample, index) => (
        <button
          class={`code-tab px-4 py-2 font-medium transition-all duration-200 border-b-2 ${
            index === 0
              ? 'border-sn-cyan text-sn-cyan'
              : 'border-transparent text-sn-fg-muted hover:text-sn-fg hover:border-sn-border'
          }`}
          data-lang={sample.lang}
        >
          <span class="mr-2">{sample.icon}</span>
          {sample.name}
        </button>
      ))}
    </div>

    <!-- Code panels -->
    <div class="relative">
      {samples.map((sample, index) => (
        <div
          class={`code-panel bg-sn-bg border border-sn-border rounded-lg overflow-hidden ${
            index === 0 ? '' : 'hidden'
          }`}
          data-lang={sample.lang}
        >
          <div class="flex items-center justify-between px-4 py-3 bg-sn-bg-alt border-b border-sn-border">
            <div class="flex items-center space-x-2">
              <div class="flex space-x-1.5">
                <div class="w-3 h-3 rounded-full bg-sn-red"></div>
                <div class="w-3 h-3 rounded-full bg-sn-yellow"></div>
                <div class="w-3 h-3 rounded-full bg-sn-green"></div>
              </div>
              <span class="text-sm text-sn-fg-muted ml-4">
                {sample.name} Example
              </span>
            </div>
            <button
              class="copy-button flex items-center space-x-2 px-3 py-1 text-sm text-sn-fg-muted hover:text-sn-cyan transition-colors rounded"
              data-code={sample.code}
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              <span>Copy</span>
            </button>
          </div>
          <div class="overflow-x-auto">
            <pre class="p-6 text-sm leading-relaxed"><code class={`language-${sample.lang}`}>{sample.code}</code></pre>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  pre {
    margin: 0;
    background: var(--color-sn-bg);
    font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace;
  }

  code {
    display: block;
    color: var(--color-sn-fg);
  }

  /* Syntax highlighting using theme colors */
  :global(.language-go .token.keyword),
  :global(.language-rust .token.keyword),
  :global(.language-typescript .token.keyword),
  :global(.language-swift .token.keyword),
  :global(.language-bash .token.keyword) {
    color: var(--color-sn-blue-green);
  }

  :global(.language-go .token.function),
  :global(.language-rust .token.function),
  :global(.language-typescript .token.function),
  :global(.language-swift .token.function) {
    color: var(--color-sn-teal);
  }

  :global(.language-go .token.string),
  :global(.language-rust .token.string),
  :global(.language-typescript .token.string),
  :global(.language-swift .token.string),
  :global(.language-bash .token.string) {
    color: var(--color-sn-teal);
  }

  :global(.language-go .token.number),
  :global(.language-rust .token.number),
  :global(.language-typescript .token.number),
  :global(.language-swift .token.number) {
    color: var(--color-sn-lavender);
  }

  :global(.language-go .token.comment),
  :global(.language-rust .token.comment),
  :global(.language-typescript .token.comment),
  :global(.language-swift .token.comment),
  :global(.language-bash .token.comment) {
    color: var(--color-sn-fg-dim);
    font-style: italic;
  }

  :global(.language-go .token.builtin),
  :global(.language-rust .token.builtin),
  :global(.language-typescript .token.builtin),
  :global(.language-swift .token.builtin) {
    color: var(--color-sn-blue-green);
  }

  :global(.language-go .token.operator),
  :global(.language-rust .token.operator),
  :global(.language-typescript .token.operator),
  :global(.language-swift .token.operator) {
    color: var(--color-sn-cyan);
  }

  :global(.language-rust .token.attribute),
  :global(.language-swift .token.attribute) {
    color: var(--color-sn-magenta);
    font-style: italic;
  }

  :global(.language-bash .token.builtin) {
    color: var(--color-sn-blue);
  }

  :global(.language-bash .token.function) {
    color: var(--color-sn-cyan);
  }
</style>

<script>
  // Tab switching
  const tabs = document.querySelectorAll('.code-tab');
  const panels = document.querySelectorAll('.code-panel');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const lang = tab.getAttribute('data-lang');

      // Update active tab
      tabs.forEach(t => {
        t.classList.remove('border-sn-cyan', 'text-sn-cyan');
        t.classList.add('border-transparent', 'text-sn-fg-muted');
      });
      tab.classList.remove('border-transparent', 'text-sn-fg-muted');
      tab.classList.add('border-sn-cyan', 'text-sn-cyan');

      // Update visible panel
      panels.forEach(panel => {
        if (panel.getAttribute('data-lang') === lang) {
          panel.classList.remove('hidden');
        } else {
          panel.classList.add('hidden');
        }
      });
    });
  });

  // Copy code functionality
  const copyButtons = document.querySelectorAll('.copy-button');

  copyButtons.forEach(button => {
    button.addEventListener('click', async () => {
      const code = button.getAttribute('data-code');
      if (code) {
        try {
          await navigator.clipboard.writeText(code);
          const span = button.querySelector('span');
          if (span) {
            const originalText = span.textContent;
            span.textContent = 'Copied!';
            setTimeout(() => {
              span.textContent = originalText;
            }, 2000);
          }
        } catch (err) {
          console.error('Failed to copy code:', err);
        }
      }
    });
  });
</script>
