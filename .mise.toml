# Mise configuration for Subliminal Nightfall
# https://mise.jdx.dev/configuration.html

# Tools: managed versions for Node, pnpm, Rust

[tools]
node = "22.10.0"
pnpm = "10.11.1"
rust = "1.82.0"

[env]
# Force pnpm to use the workspace
_.file = ".env"

[tasks.install]
description = "Install website and core dependencies"
run = "pnpm -C website install && pnpm -C packages/core install"

[tasks.dev]
description = "Start website development server (with theme generation)"
run = "mise run gen && pnpm -C website dev"

[tasks.gen]
description = "Generate all theme targets from theme.toml"
run = "cargo run --manifest-path tools/colorloom/Cargo.toml -- -c theme.toml generate"

[tasks.build]
description = "Generate themes then build all packages"
run = "mise run gen && pnpm -C website build && pnpm -C packages/core build"

[tasks."build:website"]
description = "Build website for production"
run = "pnpm -C website build"

[tasks."build:cloudflare"]
description = "Build website for Cloudflare deployment"
run = "pnpm -C website build"

[tasks.preview]
description = "Preview website build"
run = "pnpm -C website preview"

[tasks.verify]
description = "Verify symlink setup"
run = "./scripts/verify-symlinks.sh"

[tasks.clean]
description = "Clean all build artifacts"
run = "pnpm clean"

[tasks.format]
description = "Format code with Prettier"
run = "pnpm format"

[tasks.lint]
description = "Lint code with ESLint"
run = "pnpm lint"

[tasks."publish:cursor"]
description = "Publish Cursor/VS Code extension to VSCE and Open VSX"
run = "(cd cursor && pnpm dlx @vscode/vsce publish --pat \"$VSCE_TOKEN\" || echo \"VSCE publish skipped (token missing)\") && (cd cursor && pnpm dlx ovsx publish -p \"$OVSX_PAT\" || echo \"OVSX publish skipped (token missing)\")"

[tasks."publish:colorloom"]
description = "Publish colorloom to crates.io"
run = "cargo publish --manifest-path tools/colorloom/Cargo.toml"

[tasks."deploy:cloudflare"]
description = "Deploy website to Cloudflare Pages"
run = "pnpm dlx wrangler pages deploy website/dist --project-name=subliminal-nightfall"
