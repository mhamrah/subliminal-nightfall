# Cloudflare Pages Deployment Checklist

Quick reference for deploying the Subliminal Nightfall website to Cloudflare Pages.

## ‚úÖ Pre-Deployment Checklist

- [ ] All changes committed to git
- [ ] Changes pushed to `origin/main`
- [ ] Local build succeeds: `pnpm run build:cloudflare`
- [ ] Preview works: `pnpm preview`

## üîß Cloudflare Pages Settings

### Build Configuration

```
Framework preset:       Astro
Build command:          pnpm run build:cloudflare
Build output directory: website/dist
Root directory:         (leave blank)
```

### Environment Variables

| Variable | Value |
|----------|-------|
| `NODE_VERSION` | `22` |
| `PNPM_VERSION` | `10.11.1` |

### Custom Domain

Add custom domain: `subliminal-nightfall.hamrah.com`

Cloudflare will automatically:
- Configure DNS records
- Provision SSL certificate
- Set up redirects

## üöÄ Deployment Methods

### Method 1: Auto-Deploy (Recommended)

Cloudflare Pages automatically deploys on push to `main`:

```bash
git add .
git commit -m "Your changes"
git push origin main
```

Wait 2-3 minutes for build to complete.

### Method 2: Manual Deploy via Dashboard

1. Go to Cloudflare Pages dashboard
2. Select "subliminal-nightfall" project
3. Click "Create deployment"
4. Select branch `main`
5. Click "Save and Deploy"

### Method 3: Wrangler CLI

```bash
# Build locally
pnpm run build:cloudflare

# Deploy
cd website
npx wrangler pages deploy dist --project-name=subliminal-nightfall
```

## üêõ Troubleshooting

### Build Fails: "No projects matched the filters"

**Cause**: Old commit without workspace configuration
**Fix**: Ensure latest commit is deployed (commit a688295 or later)

```bash
# Verify latest commit
git log --oneline -1

# Should show: "Use unscoped website package name" or later
```

### Build Fails: "Output directory not found"

**Cause**: Build command didn't succeed
**Fix**: Check build logs for errors. Common issues:
- Missing environment variables
- Wrong Node/pnpm version
- Syntax errors in code

### Changes Not Showing on Live Site

**Cause**: Browser cache or CDN cache
**Fix**:
- Hard refresh: Cmd+Shift+R (Mac) or Ctrl+Shift+R (Windows)
- Clear browser cache
- Wait 5 minutes for CDN to propagate

### Custom Domain Not Working

**Cause**: DNS not configured or propagating
**Fix**:
1. Verify DNS records in Cloudflare DNS settings
2. Wait up to 24 hours for DNS propagation
3. Check SSL certificate status in Cloudflare Pages

## ‚ú® Post-Deployment Verification

Visit: https://subliminal-nightfall.hamrah.com

Check:
- [ ] Site loads without errors
- [ ] All navigation links work
- [ ] Color palette copy-to-clipboard works
- [ ] Code example tabs switch correctly
- [ ] Mobile menu works (test on phone or resize browser)
- [ ] Favicon displays correctly
- [ ] No console errors (check browser DevTools)

## üìä Monitoring

### Build Status

Check build status:
1. Go to Cloudflare Pages dashboard
2. View "Deployments" tab
3. Latest deployment should show "Success"

### Build Logs

If build fails:
1. Click on failed deployment
2. Click "View build log"
3. Scroll to error message
4. Fix error and redeploy

### Analytics

Enable Cloudflare Web Analytics:
1. Go to project settings
2. Enable "Web Analytics"
3. View visitor stats and performance metrics

## üîÑ Quick Commands

```bash
# Build and preview locally
pnpm run build:cloudflare && pnpm preview

# Check workspace packages
pnpm list --depth 0

# Verify website package exists
pnpm --filter website list

# Force clean build
rm -rf website/dist website/node_modules
pnpm install
pnpm run build:cloudflare
```

## üìù Notes

- **Build time**: ~30-60 seconds
- **Deploy time**: ~2-3 minutes total
- **CDN propagation**: ~5 minutes
- **DNS propagation**: Up to 24 hours (usually faster)

## üÜò Support

- **Build errors**: Check logs in Cloudflare Pages dashboard
- **DNS issues**: Verify in Cloudflare DNS settings
- **Code issues**: Test locally first with `pnpm dev`
- **General help**: https://developers.cloudflare.com/pages/

## ‚úÖ Latest Working Commit

Minimum required commit: `a688295` - "Use unscoped website package name"

This commit includes:
- Correct pnpm workspace configuration
- Website package added to workspace
- Build scripts updated to use `website` (not `@subliminal/website`)

If Cloudflare is deploying an older commit, manually trigger a new deployment.
